#MODIFIED VANILLA EVENTS

#############################################
# Found the Capital of the Rus'				#
# by Ewan Cowhig Croft						#
#############################################

#MUST be altered for when e_russia doesn't exist due to MGR
found_capital_of_the_rus_decision = {
	picture = "gfx/interface/illustrations/decisions/fp1_decision_raise_runestone.dds"
	major = yes

	ai_check_interval = 120

	desc = found_capital_of_the_rus_decision_desc
	selection_tooltip = found_capital_of_the_rus_decision_tooltip

	is_shown = {
		#DLC check.
		has_fp1_dlc_trigger = yes
		#Standard filter checks.
		is_landed = yes
		exists = dynasty
		#Must be within the North Germanic cultural sphere.
		OR = {
			culture = { has_cultural_pillar = heritage_north_germanic }	
			has_culture = culture:russian
			has_culture = culture:norman
			has_character_modifier = embraced_local_traditions_modifier
			AND = {
				exists = dynasty
				dynasty = {
					has_dynasty_modifier = settled_norse_dynasty_modifier
				}
			}
		}
		#Must be in the current de jure title:e_russia: since this decision involves title:e_russia very intimately, we don't want a custom region.
		any_held_title = {
			tier = tier_county
			title_province = { geographical_region = ghw_region_russia } #The GHW Russia region works perfectly fine over using e_russia and then makes it compatible with MGR when you remove ahistorical empires
		}
		#Aaaaaaand it's already happened in 1066, albeit with less gameplay benefits.
		NOT = { game_start_date >= 1066.09.15 }
		#Year is before 1100, just to keep this from getting weird if no one manages it early.
		current_date < 1100.1.1
		#Not repeatable.
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_founded_capital_of_rus
			}
		}
	}

	is_valid = {
		#Must be independent.
		is_independent_ruler = yes
		#Has to be around to organise the construction.
		is_imprisoned = no
		#Must have a capital within title:e_russia, as we'll use this as a fallback.
		capital_county.empire = title:e_russia
		#Should have a decent prestige level.
		OR = {
			prestige_level >= very_high_prestige_level
			AND = {
				prestige_level >= high_prestige_level
				completely_controls = title:c_kiev
			}
		}
		#Repeat the time limit concern just so that the player knows it's a thing.
		custom_description = {
			text = found_capital_of_the_rus_decision_before_last_date
			current_date <= 1100.1.1
		}
	}

	is_valid_showing_failures_only = {
		is_available_at_peace_adult = yes
	}

	effect = {
		save_scope_as = founder
		#Nab scope:founder's capital for the initial tooltip; this may be changed in the actual event.
		scope:founder.capital_county = { save_scope_as = new_rus_capital }
		show_as_tooltip = { found_capital_of_rus_scripted_effect = yes }
		trigger_event = { id = fp1_major_decisions.0011 }
		#Notifying other players is done in scope:founder's event, as scope:founder may change the circumstances of the decision with their option choice.
		hidden_effect = {
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_founded_capital_of_rus
			}
		}
	}

	cost = {
		gold = 100
		prestige = 500
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 0

		# Weight up for traits.
		modifier = {
			add = 25
			has_trait = ambitious
		}
		modifier = {
			add = 25
			has_trait = arrogant
		}
		modifier = {
			add = 25
			has_trait = architect
		}
		modifier = {
			add = 25
			has_trait = administrator
		}
		modifier = {
			add = 25
			has_trait = viking
		}

		# Weight up for game year.
		modifier = {
			add = 25
			current_year >= 920
		}
		modifier = {
			add = 25
			current_year >= 980
		}
	}
}

unite_the_southern_slavs_decision = {
	picture = "gfx/interface/illustrations/decisions/decision_realm.dds"
	major = yes
	ai_check_interval = 120
	desc = unite_the_southern_slavs_decision_desc

	is_shown = {
		culture = { has_cultural_pillar = heritage_south_slavic }
		NOT = {
			has_culture = culture:vlach # Not technically Slavic despite being in the South Slavic group.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:unite_the_southern_slavs_decision
			}
		}
	}

	is_valid = {
		culture = { has_cultural_pillar = heritage_south_slavic }
		completely_controls_region = custom_south_slavia #Has de jure Lands
		OR = {
			has_primary_title = title:k_croatia
			has_primary_title = title:k_serbia
			has_primary_title = title:k_bulgaria
			has_primary_title = title:k_dacia
			has_primary_title = title:k_moldavia
			has_primary_title = title:k_bosnia
			has_primary_title = title:k_carinthia							
		}
	}

	effect = {
		save_scope_as = southern_slav_uniter

		show_as_tooltip = { unite_the_southern_slavs_decision_effects = yes } #Actually applied in east_europe.0006 - prestige, laws, title, innovation effects

		#Events
		trigger_event = east_europe.0005
		every_player = {
			limit = {
				NOT = { this = scope:southern_slav_uniter }
				is_within_diplo_range = { CHARACTER = scope:southern_slav_uniter }
			}
			trigger_event = east_europe.0006
		}

		#Can only be done once
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:unite_the_southern_slavs_decision
		}
		set_global_variable = {
			name = unite_the_southern_slavs_decision
			value = scope:southern_slav_uniter
		}
		set_global_variable = {
			name = unite_the_southern_slavs_decision_title
			value = scope:southern_slav_uniter.primary_title
		}
	}
	

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

#Hungary: historical re-settlement program.
promote_hungarian_settlement_decision = {
	picture = "gfx/interface/illustrations/decisions/decision_realm.dds"

	desc = promote_hungarian_settlement_decision_desc
	selection_tooltip = promote_hungarian_settlement_decision_tooltip
	major = yes
	ai_goal = yes

	is_shown = {
		is_ruler = yes
		is_landed = yes
		game_start_date < 1066.1.1
		culture = { has_cultural_pillar = heritage_magyar }
		NOT = {  #Can only do it once.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_promoted_hungarian_settlement
			}
		}
		NOT = {  #Can only do either or.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_revived_magyar_paganism
			}
		}
		OR = {
			has_title = title:k_hungary
			has_title = title:e_carpathia
		}
		any_neighboring_top_liege_realm_owner = { #There are same reli neighboring Realms/Empires to take people from.
			religion = religion:christianity_religion
			count >= 2
		}
	}
	
	is_valid = {
		# Must be an Ecumenical Christian
		custom_description = {
  			text = promote_hungarian_settlement_decision_ecumenical_christian
			faith = { #Denomination of Faith must not be a heresy and must have some degree of control over its core regions.
				religion = religion:christianity_religion
				has_doctrine = special_doctrine_rome_communion	
			}
		}
		
		#Must completely control the Carpathian Basin (Hungary De Jure)
		completely_controls = title:k_hungary

		# Capital is Hungarian culture group
		capital_province = { culture = { has_cultural_pillar = heritage_magyar } }
	}

	is_valid_showing_failures_only = {
		is_capable_adult = yes
		is_imprisoned = no
		is_independent_ruler = yes
		is_at_war = no
	}

	cost = {
		prestige = 2000
		piety = 500
	}

	effect = {
		show_as_tooltip = {
			promote_hungarian_settlement_decision_scripted_effect = yes
		}
		trigger_event = {
			id = east_europe.0030
		}
		hidden_effect = {
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_promoted_hungarian_settlement
			}
		}
	}
	
	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 50
		ai_value_modifier = {
			ai_zeal = 1.0
			ai_greed = 1.0
		}
	}
}

#################################
# Found the Kingdom of Bosnia	#
# by Ewan Cowhig Croft			#
#################################
found_kingdom_of_bosnia_decision = {
	picture = "gfx/interface/illustrations/decisions/decision_destiny_goal.dds"
	major = yes

	ai_check_interval = 120

	desc = found_kingdom_of_bosnia_decision_desc
	selection_tooltip = found_kingdom_of_bosnia_decision_tooltip

	is_shown = {
		is_ruler = yes
		is_landed = yes
		exists = dynasty
		OR = {
			#Must be a Serb or Croat within the Bosnian highlands.
			AND = {
				OR = {
					culture = culture:serbian
					culture = culture:croatian
				}
				capital_county = {
					OR = {
						this = title:c_vodica
						this = title:c_pset
						this = title:c_vrbas
						this = title:c_donjikraji
						this = title:c_usora
						this = title:c_rama
						this = title:c_soli
						this = title:c_vhrbosna
						this = title:c_zavrsje
					}
				}
			}
			#Or just be Bosnian.
			culture = culture:bosnian
		}
		NOT = {	#You can only do it once.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_founded_kingdom_of_bosnia
			}
		}
		OR = {
			has_government = feudal_government
			has_government = clan_government
		}
		highest_held_title_tier <= tier_duchy
	}

	is_valid = {
		#You must have sufficient clout.
		is_independent_ruler = yes

		#You must control the kingdom's heartlands.
		has_title = title:d_bosna
		has_title = title:d_usora
		completely_controls = title:d_bosna
		completely_controls = title:d_usora

		#You must be sufficiently advanced to conceive of having a separate kingdom, rather than being Croatian or Serbian.
		culture = { has_cultural_era_or_later = culture_era_early_medieval }
	}

	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	effect = {
		save_scope_as = founder
		show_as_tooltip = { found_kingdom_of_bosnia_decision_scripted_effect = yes }
		trigger_event = { id = east_europe.0101 }
		#Notify other players.
		every_player = {
			limit = {
				NOT = { this = scope:founder }
				top_liege = {
					OR = {
						this = scope:founder
						any_neighboring_and_across_water_top_liege_realm_owner = { this = scope:founder }
					}
				}
			}
			trigger_event = east_europe.0102
		}
		hidden_effect = {
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_founded_kingdom_of_bosnia
			}
			set_global_variable = {
				name = flag_founded_kingdom_of_bosnia
				value = scope:founder
			}
		}
	}

	cost = {
		gold = 300
		prestige = 200
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}
